"use strict";(()=>{var R=new Map;async function D(e,t){if(R.has(e))return R.get(e);let r=await t(e);return R.set(e,r),r}function _(e,t){if(typeof window<"u"&&typeof document<"u"){let r=document.createElement("canvas");return r.width=e,r.height=t,r}throw new Error("Cannot create canvas")}function m(e,t){return async r=>{let a=await D(e,t);r.drawImage(a,0,0)}}function S(...e){return async t=>{for(let r of e)await r(t)}}async function C(...e){return async t=>{let r=_(t.canvas.width,t.canvas.height),a=r.getContext("2d");a?.clearRect(0,0,r.width,r.height),await S(...e)(a),t.drawImage(r,0,0)}}async function F(e,t){let r=e.getContext("2d");r.clearRect(0,0,e.width,e.height);for(let a of[...t].sort((n,f)=>n.zIndex-f.zIndex))await a.draw(r)}function Pe(e,t,r,a,n,f,l){let x=a*l+e*(1-l),p=n*l+t*(1-l),y=f*l+r*(1-l);return[x,p,y]}function He(e,t){async function r(a){if(e===0)return;let{width:n,height:f}=a.canvas,l=a.getImageData(0,0,n,f),x=a.createImageData(n,f);for(let p=0;p<n;p++)for(let y=0;y<f;y++){let i=(p+y*n)*4,o=l.data[i+0]/255,s=l.data[i+1]/255,u=l.data[i+2]/255,d=l.data[i+3]/255;if(d===0)continue;let c,h,L,b=0;d>0&&(o/=d,s/=d,u/=d),c=t[0]*o,c+=t[1]*s,c+=t[2]*u,c+=t[3]*d,c+=t[4],h=t[5]*o,h+=t[6]*s,h+=t[7]*u,h+=t[8]*d,h+=t[9],L=t[10]*o,L+=t[11]*s,L+=t[12]*u,L+=t[13]*d,L+=t[14],b=t[15]*o,b+=t[16]*s,b+=t[17]*u,b+=t[18]*d,b+=t[19],[c,h,L]=Pe(o,s,u,c,h,L,e),c*=b,h*=b,L*=b,x.data[i+0]=P(c*255),x.data[i+1]=P(h*255),x.data[i+2]=P(L*255),x.data[i+3]=P(d*255)}a.putImageData(x,0,0)}return r}function j(){let e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],t=1;function r(){return e}function a(i){e=[...i]}function n(i){t=i}function f(i,o,s){return i[0]=o[0]*s[0]+o[1]*s[5]+o[2]*s[10]+o[3]*s[15],i[1]=o[0]*s[1]+o[1]*s[6]+o[2]*s[11]+o[3]*s[16],i[2]=o[0]*s[2]+o[1]*s[7]+o[2]*s[12]+o[3]*s[17],i[3]=o[0]*s[3]+o[1]*s[8]+o[2]*s[13]+o[3]*s[18],i[4]=o[0]*s[4]+o[1]*s[9]+o[2]*s[14]+o[3]*s[19]+o[4],i[5]=o[5]*s[0]+o[6]*s[5]+o[7]*s[10]+o[8]*s[15],i[6]=o[5]*s[1]+o[6]*s[6]+o[7]*s[11]+o[8]*s[16],i[7]=o[5]*s[2]+o[6]*s[7]+o[7]*s[12]+o[8]*s[17],i[8]=o[5]*s[3]+o[6]*s[8]+o[7]*s[13]+o[8]*s[18],i[9]=o[5]*s[4]+o[6]*s[9]+o[7]*s[14]+o[8]*s[19]+o[9],i[10]=o[10]*s[0]+o[11]*s[5]+o[12]*s[10]+o[13]*s[15],i[11]=o[10]*s[1]+o[11]*s[6]+o[12]*s[11]+o[13]*s[16],i[12]=o[10]*s[2]+o[11]*s[7]+o[12]*s[12]+o[13]*s[17],i[13]=o[10]*s[3]+o[11]*s[8]+o[12]*s[13]+o[13]*s[18],i[14]=o[10]*s[4]+o[11]*s[9]+o[12]*s[14]+o[13]*s[19]+o[14],i[15]=o[15]*s[0]+o[16]*s[5]+o[17]*s[10]+o[18]*s[15],i[16]=o[15]*s[1]+o[16]*s[6]+o[17]*s[11]+o[18]*s[16],i[17]=o[15]*s[2]+o[16]*s[7]+o[17]*s[12]+o[18]*s[17],i[18]=o[15]*s[3]+o[16]*s[8]+o[17]*s[13]+o[18]*s[18],i[19]=o[15]*s[4]+o[16]*s[9]+o[17]*s[14]+o[18]*s[19]+o[19],i}function l(i){let o=[...i];return o[4]/=255,o[9]/=255,o[14]/=255,o[19]/=255,o}function x(i,o=!1){let s=i;o&&(f(s,e,i),s=l(s)),a(s)}return[()=>He(t,e),{getMatrix:r,setMatrix:a,setAlpha:n,multiply:f,colorMatrix:l,loadMatrix:x}]}function g(e,t,r){let[a,n,f]=t,[l,x,p]=r,y=[a*l,n*l,f*l,0,0,a*x,n*x,f*x,0,0,a*p,n*p,f*p,0,0,0,0,0,1,0];e.loadMatrix(y)}function P(e){return e<0?0:e>255?255:Math.round(e)}function w(e){let t=parseInt(e.substr(1,2),16)/255,r=parseInt(e.substr(3,2),16)/255,a=parseInt(e.substr(5,2),16)/255;return[t,r,a]}var I=[0,1,0],N=w("#906B4A"),V=w("#261C13"),q=w("#FEC8EA"),U=w("#C63D72"),G=w("#FFCBBF"),K=w("#FF6C62"),J=w("#F0F4FB"),Q=w("#C86C93"),X=w("#B1FF8B"),Y=w("#20BA90"),Z=w("#3D3F49"),ee=w("#161D3D"),te=w("#ED8567"),re=w("#C0421D"),oe=w("#672C32"),ae=w("#431419"),se=w("#513872"),ne=w("#1E004C"),ie=w("#D2522B"),le=w("#B73811");function W(e){return e!=null&&typeof e=="object"&&e["@@functional/placeholder"]===!0}function A(e){return function t(r){return arguments.length===0||W(r)?t:e.apply(this,arguments)}}function E(e){return function t(r,a){switch(arguments.length){case 0:return t;case 1:return W(r)?t:A(function(n){return e(r,n)});default:return W(r)&&W(a)?t:W(r)?A(function(n){return e(n,a)}):W(a)?A(function(n){return e(r,n)}):e(r,a)}}}var Re=E(function(t,r){for(var a=0,n=Math.min(t.length,r.length),f={};a<n;)f[t[a]]=r[a],a+=1;return f}),$=Re;function B(e,t){let r=Object.keys(e),a=Object.values(e);return $e(r,a,t)}function v(e,t,r){let a=Ee(Object.values(r),e,t);return $(Object.keys(r),a)}function Ee(e,t,r){let a=e.reduce((p,y)=>p+y,0),n=e.map(p=>p/a),f=r-t,l=n.map(p=>Math.round(p*f)),x=l.reduce((p,y)=>p+y,0);if(x!==f){let p=f-x,y=l.indexOf(l.reduce((i,o)=>Math.max(i,o),0));l[y]+=p}return l}function $e(e,t,r=a=>Math.random()*a){if(e.length!==t.length)throw new RangeError("Chance: Length of array and weights must match");let a=0,n;for(let i=0;i<t.length;++i){if(n=t[i],isNaN(n))throw new RangeError("Chance: All weights must be numbers");n>0&&(a+=n)}if(a===0)throw new RangeError("Chance: No valid entries in array weights");let f=r(a),l=0,x=-1,p=0;for(let i=0;i<t.length;++i){if(n=t[i],l+=n,n>0){if(f<=l){p=i;break}x=i}i===t.length-1&&(p=x)}var y=e[p];return y}var T=[{color:"Pink",filter:[e=>g(e,I,q)]},{color:"Peach",filter:[e=>g(e,I,G)]},{color:"Brown",filter:[e=>g(e,I,N)]},{color:"White",filter:[e=>g(e,I,J)]},{color:"Lime",filter:[e=>g(e,I,X)]},{color:"Black",filter:[e=>g(e,I,Z)]},{color:"Red",filter:[e=>g(e,I,te)]}],O=[{color:"Pink",filter:[e=>g(e,I,U)]},{color:"Peach",filter:[e=>g(e,I,K)]},{color:"Brown",filter:[e=>g(e,I,V)]},{color:"White",filter:[e=>g(e,I,Q)]},{color:"Lime",filter:[e=>g(e,I,Y)]},{color:"Black",filter:[e=>g(e,I,ee)]},{color:"Red",filter:[e=>g(e,I,re)]}],fe=[{color:"Red",filter:[e=>g(e,I,oe)]},{color:"Purple",filter:[e=>g(e,I,se)]},{color:"Orange",filter:[e=>g(e,I,ie)]}],Oe=[{color:"Red",filter:[e=>g(e,I,ae)]},{color:"Purple",filter:[e=>g(e,I,ne)]},{color:"Orange",filter:[e=>g(e,I,le)]}];function H(e){return["Diamond","Gold"].includes(e)}function pe({color:e},t){return{draw:m(`${e}.webp`,t),zIndex:-1/0}}function M(e,t){let r=[],a=e.find(n=>n.color===t)?.filter;return a&&r.push(...a.map(n=>{let[f,l]=j();return n(l),f()})),r}async function ze({zIndex:e,baseColor:t,secondaryColor:r,baseColorBasePath:a,secondaryColorBasePath:n},f){let l;function x(i,o,s,u){let d=["Diamond","Gold"].includes(o),c=[m(`${s}/${d?o:u}.webp`,f)];return d||c.push(...M(i,o)),c}let p=x(T,t,a,"BaseColor"),y=r?x(T,r,n,"SplitColor"):[];return l=S(await C(...p),await C(...y)),{draw:l,zIndex:e}}function ce({color:e,splitColor:t},r){return ze({zIndex:-1e5,baseColor:e,secondaryColor:t,baseColorBasePath:"BaseColor",secondaryColorBasePath:"SplitColor"},r)}async function de({color:e,splitColor:t,tailType:r},a){let n=[];if(e=t??e,H(e))n.push(m(`Tails/${r}-Colors/${e}.webp`,a));else{let f=M(T,e),l=M(O,e);n.push(await C(m(`Tails/${r}-Colors/${r}-Base.webp`,a),...f),await C(m(`Tails/${r}-Colors/${r}-Accent.webp`,a),...l))}return n.push(m(`Tails/${r}.webp`,a)),[{draw:await C(...n),zIndex:-1e3}]}function me(e){return{draw:m("Base/Base.webp",e),zIndex:1700}}async function xe({color:e,faceType:t,frillType:r,mouthType:a,headType:n,specialType:f,splitColor:l,mustache:x},p){return f==="None"?[...await ue({color:e,frillType:r,splitColor:l},p),...await De({mouthType:a,mustache:x},p),_e({faceType:t},p),Fe({color:e,splitColor:l,headType:n},p)]:f==="TV Head"?[{draw:m(`Special/${f}.webp`,p),zIndex:1e9}]:[{draw:m(`Special/${f}.webp`,p),zIndex:1e9},...await ue({color:e,frillType:r,splitColor:l},p)]}async function ue({color:e,splitColor:t,frillType:r},a){let n=[];if(H(e))n.push(m(`Ears/${r}-Colors/Base/${e}.webp`,a));else{let f=M(T,e),l=M(O,e);n.push(await C(m(`Ears/${r}-Colors/${r}-Base.webp`,a),...f),await C(m(`Ears/${r}-Colors/${r}-Accent.webp`,a),...l))}if(t)if(H(t))n.push(m(`Ears/${r}-Colors/Base/${t}.webp`,a));else{let f=M(T,t),l=M(O,t);n.push(await C(m(`Ears/${r}-Colors/${r}-Base-Split.webp`,a),...f),await C(m(`Ears/${r}-Colors/${r}-Accent-Split.webp`,a),...l))}return n.push(m(`Ears/${r}.webp`,a)),[{draw:await C(...n),zIndex:1500}]}async function De({mouthType:e,mustache:t},r){return[{draw:m(`Mouths/${e}.webp`,r),zIndex:9999990},...t?[{draw:m("Mouths/Moustache.webp",r),zIndex:10000010}]:[]]}function _e({faceType:e},t){return{draw:m(`Eyes/${e}.webp`,t),zIndex:1e7}}function Fe({headType:e,color:t,splitColor:r},a){let n;return["Side","Tuft"].includes(e)?n=S(m(`Head/${e}-Color/${r||t}.webp`,a),m(`Head/${e}.webp`,a)):n=m(`Head/${e}.webp`,a),{draw:n,zIndex:10000005}}async function he({armType:e,color:t,splitColor:r},a){let n=[];if(H(t))n.push(m(`Arms/${e}-Colors/Base/${t}.webp`,a));else if(n.push(await C(m(`Arms/${e}-Colors/${e}-Base.webp`,a),...M(T,t))),r){let f=M(T,r);n.push(await C(m(`Arms/${e}-Colors/${e}-Split.webp`,a),...f))}return[{draw:S(await C(...n),m(`Arms/${e}.webp`,a)),zIndex:1000105}]}async function ye({accessoryType:e,color:t},r){let a=[];return e==="Flamingo"?(a.push({draw:m(`Accessories/${e}B.webp`,r),zIndex:5e4}),a.push({draw:m(`Accessories/${e}T.webp`,r),zIndex:1000500})):e==="Hoodie"?(a.push({draw:await C(m("Accessories/HoodieBase.webp",r),...M(fe,t)),zIndex:1e6}),a.push({draw:await C(m("Accessories/HoodieLine.webp",r)),zIndex:1000030}),a.push({draw:await C(m("Accessories/SleevesColor.webp",r),...M(fe,t)),zIndex:1000500}),a.push({draw:await C(m("Accessories/HoodieAccent.webp",r),...M(Oe,t)),zIndex:1000020}),a.push({draw:await C(m("Accessories/SleevesLine.webp",r)),zIndex:1000530})):e!=="None"&&a.push({draw:m(`Accessories/${e}.webp`,r),zIndex:1000500}),a}var ge=v(0,255,{Blue:40,Gold:7,Lime:3,Pink:20,Salmon:20,Turquoise:20,White:1}),we=v(0,255,{Normal:6,Curled:3,Wiggles:1,Short:.5}),z=v(0,255,{Pink:30.25,Peach:24,Brown:16,White:20,Gold:.5,Diamond:.25,Lime:1,Black:10}),Ie=v(0,255,{Split:2,"Not Split":48}),Ce=v(0,255,{None:98.5,"Skull Face":.5,"TV Head":.5,"Giant Eye":.5}),be=v(0,255,{Claws:8,Paws:2}),ve=v(0,255,{Short:2,Wide:3,Thin:4,Wiggles:1,Puffy:1,"Teenie Tiny":1}),Be=v(0,255,{None:40,"Bow Tie":16,Heart:12,"Neck Tie":5,"Rainbow Cape":3,Flamingo:3,Floaties:8,Hoodie:2}),Le=v(0,255,{Red:10,Orange:50,Purple:10}),Me=v(0,255,{Anger:10,"Clout Goggles":3,Derp:7,Lash:25,Oval:30,Troll:4,Visor:6,Bored:9,Disapproval:4}),We=v(0,255,{Bleh:11,Blunt:2,"Happy mouth":17,owo:14,Plain:10,Smile:19,Smirk:18,"Smol frown":7,Fangs:4}),ke=v(0,255,{Mustache:3,"Clean Shaven":97}),Te=v(0,255,{Bald:40,Tuft:22,Side:14,"Cowboy Hat":5,Crown:1,Halo:2,Octopus:1.5,"Party Hat":3,"Spin Beanie":2.5,Beanie:5.5,Birdie:3.5});function Ne(e){let t="";for(let r=0;r<e.length;r++){let a=e[r].toString(16);a=a.length===1?"0"+a:a,t+=a}return t}function Ve(e){let t=e,r=b=>{if(b!=255)throw new Error(`Expected a range of 255 but got ${b}`);let k=t[0];return t=t.slice(1),k},a=B(ge,r),n=B(z,r),f=B(Ie,r),l;if(f==="Split"){let b={...z};delete b[n];let k=v(0,255,b);l=B(k,r)}else t=t.slice(1);let x=B(Be,r),p=B(Le,r),y=B(we,r),i=B(be,r),o=B(ve,r),s=B(Me,r),u=B(We,r),d=B(ke,r),c=B(Te,r),h=B(Ce,r);return["Cloud Goggles","Troll","Visor"].includes(s)&&(d="Clean Shaven"),{metadata:{seed:Ne(e),attributes:[{trait_type:"Background Color",value:a},{trait_type:"Base Color",value:n},...f==="Split"&&typeof l<"u"?[{trait_type:"Secondary Color",value:l}]:[],...h!=="None"?[{trait_type:"Special Feature",value:h}]:[],{trait_type:"Accessory",value:x},...x==="Hoodie"?[{trait_type:"Accessory Color",value:p}]:[],{trait_type:"Tail",value:y},{trait_type:"Arm",value:i},{trait_type:"Frills",value:o},{trait_type:"Face",value:s},{trait_type:"Mouth",value:u},{trait_type:"Facial Hair",value:d},{trait_type:"Head",value:c}]},arm:i,special:h,accessory:x,accessoryColor:p,backgroundColor:a,baseColor:n,split:f,secondaryColor:l,tail:y,face:s,frills:o,mouth:u,head:c,mustache:d}}async function Se(e,t){let{metadata:r,arm:a,special:n,accessory:f,accessoryColor:l,backgroundColor:x,baseColor:p,secondaryColor:y,tail:i,face:o,frills:s,mouth:u,head:d,mustache:c}=Ve(e);return{metadata:r,layers:[pe({color:x},t),await ce({color:p,splitColor:y},t),...await ye({accessoryType:f,color:l},t),...await he({armType:a,color:p,splitColor:y},t),...await xe({frillType:s,faceType:o,mouthType:u,headType:d,specialType:n,color:p,splitColor:y,mustache:c==="Mustache"},t),me(t),...await de({color:p,splitColor:y,tailType:i},t)]}}function qe(e){return new Uint8Array(e.match(/.{1,2}/g).map(t=>parseInt(t,16))).buffer}async function Ue(){let e=new URL(window.location.href).pathname.split("/").pop(),{tokenId:t,revealedAt:r}=await fetch(`/r/metadata/${e||"0"}`).then(u=>u.json()).then(u=>window.CBOR.decode(qe(u))),a=document.querySelector("canvas#main");function n(u){return`/content/assets/${u}`}let f=null;async function l(u){let{layers:d,metadata:c}=await Se(u,b=>{let k=document.createElement("img");return k.src=n(b),k.crossOrigin="anonymous",new Promise(Ae=>{k.onload=()=>Ae(k)})});f=c;let h=document.createElement("canvas");h.width=569,h.height=569,await F(h,d),a.getContext("2d").drawImage(h,0,0)}function x(u){let d=new Uint8Array(u);for(let c=0;c<u;c++)d[c]=Math.floor(Math.random()*256);return d}async function p(){let u=null;try{u=await(await fetch(`/r/blockhash/${r}`)).json()}catch{return null}if(!u)try{let c=await fetch("/r/blockhash");if(c.status!==200)return x(32);u=await c.json()}catch{return null}return await crypto.subtle.digest("SHA-256",new TextEncoder().encode(u+t))}async function y(){try{return Number(await fetch("/r/blockheight").then(u=>u.json()))}catch{return null}}async function i(){let u=!1,d=await y();if(!d||d<r){let c=d?r-d:99999999,h=a.getContext("2d");h.fillStyle="black",h.fillRect(0,0,569,569),h.fillStyle="white",h.font="30px Arial",h.textAlign="center",h.fillText("Revealing in progress...",a.width/2,a.height/2-20),d&&h.fillText(`Blocks remaining: ${c}`,a.width/2,a.height/2+20),u=!1}else{let c=await p(),h;if(c){let L=new Uint8Array(c);h=new Uint8Array(L.slice(0,32)),u=!0}else h=x(32);await l(h)}u||setTimeout(i,5e3)}i();function o(){var u=Math.min(window.innerWidth/569,window.innerHeight/569);a.style.width=569*u+"px",a.style.height=569*u+"px"}window.addEventListener("resize",o,!1),o();let s=u=>{u.preventDefault();let d=a.toDataURL("image/png"),c=document.createElement("a");c.href=d,c.download=`${t}.png`,c.click()};a.addEventListener("contextmenu",s),a.addEventListener("touchstart",u=>{u.preventDefault();let d=setTimeout(s,2e3,u);a.addEventListener("touchend",()=>clearTimeout(d))}),window.addEventListener("keydown",u=>{if(u.key==="m"){u.preventDefault();let d=JSON.stringify({tokenId:t,...f},null,2),c=document.createElement("a");c.href="data:text/json;charset=utf-8,"+encodeURIComponent(d),c.download=`${t}.json`,c.click()}})}Ue();})();
